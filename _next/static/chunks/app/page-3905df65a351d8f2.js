(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8659:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s,l=a(6166),r=a(5766),n=a(7830),i=a(1964),o=a(9591);let u=(0,n.default)(()=>Promise.all([a.e(452),a.e(397)]).then(a.bind(a,6347)),{loadableGenerated:{webpack:()=>[6347]},ssr:!1}),c=null!=(s=o.env.NEXT_PUBLIC_API_BASE)?s:"https://baau72q1kd.execute-api.us-east-1.amazonaws.com/Prod";function d(){let[e,t]=(0,r.useState)("idle"),[a,s]=(0,r.useState)(null),[n,o]=(0,r.useState)(0),[d,h]=(0,r.useState)(null),[m,b]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[x,g]=(0,r.useState)(null),w=(0,r.useRef)(null),y=(0,r.useRef)(null),j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;v(),y.current=setInterval(()=>{o(e=>e<95?Math.min(e+t,95):e)},e)},v=()=>{y.current&&clearInterval(y.current),y.current=null},N=async()=>{var e;let t=await fetch("".concat(c,"/jobs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({params:{sql_1:"true",sql_2:"true"}}),signal:null==(e=w.current)?void 0:e.signal});if(!t.ok){let e=await t.text().catch(()=>"");throw Error("Create job failed: ".concat(t.status," ").concat(t.statusText," ").concat(e))}return t.json()},_=async e=>{var t;let a=await fetch("".concat(c,"/jobs/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"},signal:null==(t=w.current)?void 0:t.signal});if(!a.ok){let e=await a.text().catch(()=>"");throw Error("Get status failed: ".concat(a.status," ").concat(a.statusText," ").concat(e))}return a.json()},k=async()=>{var e,a;null==(e=w.current)||e.abort(),v(),h(null),f(null),g(null),o(0),t("queued"),w.current=new AbortController;try{j(500,10);let e=await N();s(e.job_id),t("running");let l=0;for(;l<60;){let s=await _(e.job_id);if(t(s.status),"number"!=typeof s.progress||Number.isNaN(s.progress)||o(Math.min(Math.max(0,s.progress),"succeeded"===s.status?100:95)),"succeeded"===s.status){v(),o(100);let e="string"==typeof s.result?JSON.parse(s.result):s.result;"object"==typeof e&&null!==e&&"sql_1"in e&&"sql_2"in e&&Array.isArray(e.sql_1)&&Array.isArray(e.sql_2)?b(e):h("Unexpected result shape (missing sql_1/sql_2)");return}if("failed"===s.status){v(),h(null!=(a=s.error)?a:"Job failed");return}let r=Math.min(500*(l+1),5e3);await new Promise(e=>setTimeout(e,r)),l++}v(),h("Polling timed out")}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;h(e instanceof Error?e.message:"Unknown error"),v()}};return(0,r.useEffect)(()=>(k(),()=>{var e;null==(e=w.current)||e.abort(),v()}),[]),(0,r.useEffect)(()=>{if(!m)return;let e={categories:m.sql_1.map(e=>e.label),values:m.sql_1.map(e=>e.instance_count)};f(e),g(function(e,t){let a=t&&t.length?[...t]:Array.from(new Set(e.map(e=>e.label))).sort(),s=Array.from(new Set(e.map(e=>e.split))),l={},r={};for(let e of s)l[e]=new Map,r[e]=0;for(let t of e){var n;let e=null!=(n=l[t.split].get(t.label))?n:0;l[t.split].set(t.label,e+t.objects),r[t.split]+=t.objects}let i=s.map(e=>{let t=a.map(t=>{var a;return null!=(a=l[e].get(t))?a:0}),s=a.map(t=>{var a;let s=null!=(a=l[e].get(t))?a:0,n=r[e]||1;return"".concat((s/n*100).toFixed(1),"%")});return{type:"bar",name:e,x:a,y:t,text:s,textposition:"auto"}});return{categories:a,traces:i}}(m.sql_2,e.categories).traces)},[m]),(0,l.jsx)("div",{className:"min-h-screen grid place-items-center p-6",children:(0,l.jsxs)("main",{className:"w-full max-w-6xl space-y-6 px-4",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold",children:"Athena-Powered Dashboard with SQS/Lambda Backend"}),(0,l.jsx)("button",{onClick:k,className:"rounded-md border px-3 py-1.5 text-sm hover:bg-black/5 dark:hover:bg-white/10",disabled:"running"===e||"queued"===e,children:"running"===e||"queued"===e?"Running…":"Run again"})]}),(0,l.jsxs)("div",{className:"space-y-2 w-full",children:[(0,l.jsx)("div",{className:"w-full overflow-hidden rounded-lg border",children:(0,l.jsx)(i.default,{src:"".concat("/aws-lambda-terraform","/graph.svg"),alt:"Graph",width:1600,height:900,className:"w-full h-auto"})}),(0,l.jsx)("h1",{className:"text-2xl font-semibold",children:"SQL-Based Label Statistics and Stratified Dataset Partitioning for Object Detection Using the Pascal VOC Dataset"})]}),("queued"===e||"running"===e)&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"w-full h-3 rounded bg-black/10 dark:bg-white/10 overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-black/70 dark:bg-white/80 transition-all",style:{width:"".concat(Math.round(n),"%")},role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(n)})}),(0,l.jsxs)("div",{className:"text-sm opacity-70",children:["queued"===e?"Queuing…":"Running…"," ",Math.round(n),"%"]})]}),(0,l.jsx)("div",{className:"rounded border p-4 space-y-1 text-sm",children:d&&(0,l.jsxs)("p",{className:"text-red-600",children:[(0,l.jsx)("strong",{children:"Error:"})," ",d]})}),"succeeded"===e&&p&&(0,l.jsx)(u,{data:[{x:p.categories,y:p.values,type:"bar",marker:{color:"steelblue"}}],layout:{title:{text:"Object Instances (All Data)"},xaxis:{title:{text:"Label"}},yaxis:{title:{text:"Instances"}},margin:{l:60,r:20,b:80,t:60},autosize:!0,height:400},style:{width:"100%",height:"100%"},useResizeHandler:!0,config:{displayModeBar:!1}}),"succeeded"===e&&x&&(0,l.jsx)(u,{data:x,layout:{title:{text:"Objects per Label (by Split)"},barmode:"group",xaxis:{title:{text:"Label"},tickangle:-30},yaxis:{title:{text:"Objects"}},margin:{l:60,r:20,b:80,t:60},autosize:!0,height:420},style:{width:"100%",height:"100%"},useResizeHandler:!0,config:{displayModeBar:!1}})]})})}},9525:(e,t,a)=>{Promise.resolve().then(a.bind(a,8659))}},e=>{e.O(0,[79,544,134,358],()=>e(e.s=9525)),_N_E=e.O()}]);