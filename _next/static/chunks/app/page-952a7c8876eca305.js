(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1816:(e,t,n)=>{"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(3564)},2345:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,n(2695).createAsyncLocalStorage)()},2695:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return u}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let a="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return a?new a:new r}function s(e){return a?a.bind(e):r.bind(e)}function u(){return a?a.snapshot():function(e,...t){return e(...t)}}},3829:(e,t,n)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),n(6166),n(1283),n(5374),n(3331)},4395:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let r=n(5100)._(n(5307));function a(e,t){var n;let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,r.default)({...l,modules:null==(n=l.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4667:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r,a=n(6166),l=n(5766),s=n(4395),u=n.n(s),o=n(9591);let i=u()(()=>Promise.all([n.e(452),n.e(397)]).then(n.bind(n,6347)),{loadableGenerated:{webpack:()=>[6347]},ssr:!1}),c=null!=(r=o.env.NEXT_PUBLIC_API_BASE)?r:"https://baau72q1kd.execute-api.us-east-1.amazonaws.com/Prod";function d(){let[e,t]=(0,l.useState)("idle"),[n,r]=(0,l.useState)(null),[s,u]=(0,l.useState)(0),[o,d]=(0,l.useState)(null),[f,b]=(0,l.useState)(null),[p,h]=(0,l.useState)(null),[g,m]=(0,l.useState)(null),y=(0,l.useRef)(null),x=(0,l.useRef)(null),j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;v(),x.current=setInterval(()=>{u(e=>e<95?Math.min(e+t,95):e)},e)},v=()=>{x.current&&clearInterval(x.current),x.current=null},_=async()=>{var e;let t=await fetch("".concat(c,"/jobs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({params:{sql_1:"true",sql_2:"true"}}),signal:null==(e=y.current)?void 0:e.signal});if(!t.ok){let e=await t.text().catch(()=>"");throw Error("Create job failed: ".concat(t.status," ").concat(t.statusText," ").concat(e))}return t.json()},w=async e=>{var t;let n=await fetch("".concat(c,"/jobs/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"},signal:null==(t=y.current)?void 0:t.signal});if(!n.ok){let e=await n.text().catch(()=>"");throw Error("Get status failed: ".concat(n.status," ").concat(n.statusText," ").concat(e))}return n.json()},O=async()=>{var e,n;null==(e=y.current)||e.abort(),v(),d(null),h(null),m(null),u(0),t("queued"),y.current=new AbortController;try{j(500,10);let e=await _();r(e.job_id),t("running");let a=0;for(;a<60;){let r=await w(e.job_id);if(t(r.status),"number"!=typeof r.progress||Number.isNaN(r.progress)||u(Math.min(Math.max(0,r.progress),"succeeded"===r.status?100:95)),"succeeded"===r.status){v(),u(100);let e="string"==typeof r.result?JSON.parse(r.result):r.result;"object"==typeof e&&null!==e&&"sql_1"in e&&"sql_2"in e&&Array.isArray(e.sql_1)&&Array.isArray(e.sql_2)?b(e):d("Unexpected result shape (missing sql_1/sql_2)");return}if("failed"===r.status){v(),d(null!=(n=r.error)?n:"Job failed");return}let l=Math.min(500*(a+1),5e3);await new Promise(e=>setTimeout(e,l)),a++}v(),d("Polling timed out")}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;d(e instanceof Error?e.message:"Unknown error"),v()}};return(0,l.useEffect)(()=>(O(),()=>{var e;null==(e=y.current)||e.abort(),v()}),[]),(0,l.useEffect)(()=>{if(!f)return;let e={categories:f.sql_1.map(e=>e.label),values:f.sql_1.map(e=>e.instance_count)};h(e),m(function(e,t){let n=t&&t.length?[...t]:Array.from(new Set(e.map(e=>e.label))).sort(),r=Array.from(new Set(e.map(e=>e.split))),a={},l={};for(let e of r)a[e]=new Map,l[e]=0;for(let t of e){var s;let e=null!=(s=a[t.split].get(t.label))?s:0;a[t.split].set(t.label,e+t.objects),l[t.split]+=t.objects}let u=r.map(e=>{let t=n.map(t=>{var n;return null!=(n=a[e].get(t))?n:0}),r=n.map(t=>{var n;let r=null!=(n=a[e].get(t))?n:0,s=l[e]||1;return"".concat((r/s*100).toFixed(1),"%")});return{type:"bar",name:e,x:n,y:t,text:r,textposition:"auto"}});return{categories:n,traces:u}}(f.sql_2,e.categories).traces)},[f]),(0,a.jsx)("div",{className:"min-h-screen grid place-items-center p-6",children:(0,a.jsxs)("main",{className:"w-full max-w-3xl space-y-6",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Data Distribution from Athena"}),(0,a.jsx)("button",{onClick:O,className:"rounded-md border px-3 py-1.5 text-sm hover:bg-black/5 dark:hover:bg-white/10",disabled:"running"===e||"queued"===e,children:"running"===e||"queued"===e?"Running…":"Run again"})]}),("queued"===e||"running"===e)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"w-full h-3 rounded bg-black/10 dark:bg-white/10 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-black/70 dark:bg-white/80 transition-all",style:{width:"".concat(Math.round(s),"%")},role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Math.round(s)})}),(0,a.jsxs)("div",{className:"text-sm opacity-70",children:["queued"===e?"Queuing…":"Running…"," ",Math.round(s),"%"]})]}),(0,a.jsxs)("div",{className:"rounded border p-4 space-y-1 text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Job ID:"})," ",null!=n?n:"—"]}),o&&(0,a.jsxs)("p",{className:"text-red-600",children:[(0,a.jsx)("strong",{children:"Error:"})," ",o]})]}),"succeeded"===e&&p&&(0,a.jsx)(i,{data:[{x:p.categories,y:p.values,type:"bar",marker:{color:"steelblue"}}],layout:{title:{text:"Object Instances (All Data)"},xaxis:{title:{text:"Label"}},yaxis:{title:{text:"Instances"}},margin:{l:60,r:20,b:80,t:60},autosize:!0,height:400},style:{width:"100%",height:"100%"},useResizeHandler:!0,config:{displayModeBar:!1}}),"succeeded"===e&&g&&(0,a.jsx)(i,{data:g,layout:{title:{text:"Objects per Label (by Split)"},barmode:"group",xaxis:{title:{text:"Label"},tickangle:-30},yaxis:{title:{text:"Objects"}},margin:{l:60,r:20,b:80,t:60},autosize:!0,height:420},style:{width:"100%",height:"100%"},useResizeHandler:!0,config:{displayModeBar:!1}})]})})}},5307:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=n(6166),a=n(5766),l=n(1816);function s(e){return{default:e&&"default"in e?e.default:e}}n(3829);let u={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},o=function(e){let t={...u,...e},n=(0,a.lazy)(()=>t.loader().then(s)),o=t.loading;function i(e){let s=o?(0,r.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,u=!t.ssr||!!t.loading,i=u?a.Suspense:a.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(i,{...u?{fallback:s}:{},children:c})}return i.displayName="LoadableComponent",i}},5374:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=n(2345)},9525:(e,t,n)=>{Promise.resolve().then(n.bind(n,4667))}},e=>{e.O(0,[544,134,358],()=>e(e.s=9525)),_N_E=e.O()}]);